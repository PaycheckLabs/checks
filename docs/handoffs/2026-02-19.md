# Checks Handoff - 2026-02-19

## 1) Current Status
- Repo is stable and green.
- PaymentChecks v1 spec is locked for testnet.
- Foundry can deploy and broadcast live transactions to Polygon Amoy (chainId 80002).
- We have completed an end-to-end on-chain smoke run: deploy, mint funded check, redeem.

## 2) Repo Links
- Repo: https://github.com/PaycheckLabs/checks
- Whitepaper: https://paycheck-labs.gitbook.io/checks-whitepaper
- Spec lock doc (v1): docs/specs/payment-checks-v1.md

## 3) What Shipped and Is Now on main
Contracts and scripts
- packages/contracts/src/PaymentChecks.sol
- packages/contracts/src/IPaymentChecks.sol
- packages/contracts/script/DeployPaymentChecks.s.sol
- packages/contracts/script/DeployAndSmoke.s.sol

Spec lock and test expansion
- docs/specs/payment-checks-v1.md
- packages/contracts/test/helpers/EdgeCaseERC20s.sol
- packages/contracts/test/PaymentChecks.additional.t.sol

CI stability work
- .github/workflows/contracts.yml installs forge-std before forge build/test
- packages/contracts/lib/forge-std exists as a submodule (CI still clones forge-std today)
- ignore rules hardened so secrets do not get committed
- packages/contracts/.env.example includes Amoy placeholders

## 4) Locked v1 Decisions (Testnet)
- No expiration in v1.
- claimableAt rules:
  - claimableAt == 0 means instant and is normalized to createdAt.
  - post-dated checks are claimable only after claimableAt.
- Void rules:
  - only issuer can void
  - only while now < claimableAt
  - this prevents post-dated scams (issuer can cancel before it becomes claimable)
- NFT is never burned, even after redeem or void.

## 5) On-Chain Proof (Amoy)
Deployer wallet (dev only)
- https://amoy.polygonscan.com/address/0x3E8f069a088369B62CAB761633b80fBCB941a379

Contracts deployed on Amoy
- PaymentChecks (ERC-721): https://amoy.polygonscan.com/address/0x582b029817720d6eb82E087b21A870956777F7B9
- MockERC20 (mUSD, ERC-20): https://amoy.polygonscan.com/address/0x1F9398438630C0896fc58375A03BfaAF3F1b21e9

Key transactions
- Mint funded Payment Check (checkId 1):
  https://amoy.polygonscan.com/tx/0xc40b125a49eaa75594eafd96da23fb0dfd6889eeefc1bb226cf0d5b60275f02a
- Redeem Payment Check (checkId 1):
  https://amoy.polygonscan.com/tx/0xb35ef4da84f1ccb1e2f3c328fe2e90db6a499a155f0303e0413768f95faaaab0

## 6) How To Reproduce the On-Chain Smoke Run (PowerShell)
From repo root:
- cd .\packages\contracts

Set environment variables (PowerShell):
- $env:AMOY_RPC_URL = "https://rpc-amoy.polygon.technology"
- $env:PRIVATE_KEY = "0xYOUR_TEST_WALLET_PRIVATE_KEY"

Run (broadcasts transactions):
- forge script script/DeployAndSmoke.s.sol:DeployAndSmoke --rpc-url $env:AMOY_RPC_URL --broadcast -vvv

Notes:
- Use a dedicated test wallet only.
- Do not commit secrets.
- Broadcast artifacts write to:
  - packages/contracts/broadcast/...
  - packages/contracts/cache/...

## 7) Current Milestones (New Labels)
M0 (complete)
- Repo CI stabilized
- PaymentChecks v1 baseline implemented
- First successful on-chain Amoy smoke run (deploy + mint check + redeem)

Proposed next milestones
- M1: Repeatable smoke coverage (transfer + void + post-dated claim), and stronger test suite
- M2: Explorer prototype (index events, deterministic status, check detail by id)
- M3: Basic web flow (connect wallet, mint, view, redeem)
- M4: Testnet beta release (deployed + verified + monitored)

## 8) Next Objectives (Immediate)
1. Expand DeployAndSmoke to include:
   - Transfer check to a second wallet, then redeem
   - Post-dated mint, attempt early redeem (revert), then redeem after time
   - Void a post-dated check before claimableAt, then confirm redeem is blocked
2. Add Foundry tests mirroring the above behaviors and edge cases.
3. Decide CI trigger policy:
   - Keep PR-only, or also run on pushes to main.
4. Optional but recommended:
   - Verify contracts on Amoy Polygonscan.
   - Create a deployments file for Explorer (example: packages/contracts/deployments/amoy.json).

## 9) Risks and Notes
- forge-std is both a submodule and also cloned in CI. Decide which approach we want long-term.
- Keep v1 minimal. No expiration until we deliberately design the settlement policy and tests.

## 10) Closeout
We proved the core PaymentChecks loop on-chain on Amoy:
deploy contracts, mint collateral, approve, mint funded check NFT, redeem and receive payout.
We are ready to expand smoke coverage, strengthen tests, and begin Explorer planning.
