# Milestone M1: Repeatable Smoke Suite, Flow Coverage, and Check Identity

Status: In progress

## Summary
M1 expands the Amoy smoke coverage and the Foundry test suite to cover the key PaymentChecks v1 flows. It also establishes the Check identity layer (serial and QR conventions) so Explorer planning has a stable target. CI remains green throughout.

## Scope
- Expand on-chain Amoy smoke coverage
- Add Foundry tests for the same flows and edge cases
- Document repeatable smoke execution
- Establish serial and QR conventions for Check identity and Explorer linking
- Keep CI green
- No expiration added in v1

## Deliverables
Completed
- DeployAndSmoke expanded to cover:
  - transfer-before-redeem (requires second key for full coverage)
  - post-dated redeem revert checks
  - issuer void flow and redeem-after-void revert check
- Foundry tests expanded to cover:
  - transfer-before-redeem
  - post-dated redeem revert checks, then success after claimableAt
  - issuer void flow and redeem-after-void revert check
  - edge-case ERC20 behavior (no-return, false-return, reentrancy patterns)
- Amoy smoke runbook added:
  - docs/runbooks/amoy-smoke.md

Planned
- Serial and QR strategy documented and finalized:
  - ambiguity-free character set (exclude confusing characters)
  - serial format and combination sizing
  - QR payload uses the canonical Explorer route
- Explorer entry points locked:
  - canonical check URL route format for QR payload
  - minimum data required to render a Check detail page

## Local reproduction (PowerShell)
```powershell
cd C:\Users\James\checks\packages\contracts

$env:AMOY_RPC_URL = "https://rpc-amoy.polygon.technology"
$env:PRIVATE_KEY = "0xISSUER_PRIVATE_KEY"
$env:SECOND_PRIVATE_KEY = "0xHOLDER_PRIVATE_KEY"  # optional but recommended

forge script script/DeployAndSmoke.s.sol:DeployAndSmoke --rpc-url $env:AMOY_RPC_URL --broadcast -vvv
