# Milestone M1: Repeatable Smoke Suite and v1 Flow Coverage

Status: In progress

## Summary
M1 expands the Amoy smoke coverage and the Foundry test suite to cover the key PaymentChecks v1 flows. The goal is repeatable on-chain validation for mint, transfer, post-dated claim gating, and issuer void behavior while keeping CI green.

## Scope
- Expand on-chain Amoy smoke coverage
- Add Foundry tests for the same flows and edge cases
- Keep CI green
- No expiration added in v1

## Deliverables
- DeployAndSmoke expanded to cover:
  - transfer-before-redeem (requires second key for full coverage)
  - post-dated redeem revert checks
  - issuer void flow and redeem-after-void revert check
- Foundry tests expanded to cover:
  - transfer-before-redeem
  - post-dated redeem revert checks, then success after claimableAt
  - issuer void flow and redeem-after-void revert check
  - edge-case ERC20 behavior (no-return, false-return, and reentrancy patterns)
- CI remains stable and green

## Local reproduction (PowerShell)
```powershell
cd C:\Users\James\checks\packages\contracts

$env:AMOY_RPC_URL = "https://rpc-amoy.polygon.technology"
$env:PRIVATE_KEY = "0xISSUER_PRIVATE_KEY"
$env:SECOND_PRIVATE_KEY = "0xHOLDER_PRIVATE_KEY"  # optional but recommended

forge script script/DeployAndSmoke.s.sol:DeployAndSmoke --rpc-url $env:AMOY_RPC_URL --broadcast -vvv
